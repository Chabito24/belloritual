generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "mysql"
}

model blog_publicaciones {
  id             Int                       @id @default(autoincrement())
  titulo         String                    @db.VarChar(180)
  slug           String                    @unique(map: "uk_blog_slug") @db.VarChar(200)
  resumen        String?                   @db.VarChar(300)
  contenido      String                    @db.LongText
  imagen_url     String?                   @db.VarChar(500)
  estado         blog_publicaciones_estado @default(BORRADOR)
  publicado_en   DateTime?                 @db.Timestamp(0)
  autor_id       Int?
  creado_en      DateTime                  @default(now()) @db.Timestamp(0)
  actualizado_en DateTime                  @default(now()) @db.Timestamp(0)
  usuarios_admin usuarios_admin?           @relation(fields: [autor_id], references: [id], map: "fk_blog_autor")

  @@index([autor_id], map: "fk_blog_autor")
  @@index([estado, publicado_en], map: "idx_blog_estado_publicado")
}

model clientes {
  id               Int       @id @default(autoincrement())
  nombre           String    @db.VarChar(80)
  apellido         String    @db.VarChar(80)
  fecha_nacimiento DateTime? @db.Date
  correo           String?   @unique(map: "uk_clientes_correo") @db.VarChar(150)
  direccion        String?   @db.VarChar(200)
  whatsapp         String?   @unique(map: "uk_clientes_whatsapp") @db.VarChar(30)
  observaciones    String?   @db.Text
  creado_en        DateTime  @default(now()) @db.Timestamp(0)
  actualizado_en   DateTime  @default(now()) @db.Timestamp(0)
}

model materiales {
  id                  Int                   @id @default(autoincrement()) @db.UnsignedInt
  nombre              String                @unique(map: "uk_materiales_nombre") @db.VarChar(60)
  tipo                materiales_tipo
  unidad              materiales_unidad
  costo_unitario      Decimal               @db.Decimal(12, 2)
  activo              Boolean               @default(true)
  creado_en           DateTime              @default(now()) @db.DateTime(0)
  actualizado_en      DateTime              @default(now()) @db.DateTime(0)
  servicio_materiales servicio_materiales[]
}

model servicio_materiales {
  servicio_id Int        @db.UnsignedInt
  material_id Int        @db.UnsignedInt
  cantidad    Decimal    @db.Decimal(12, 4)
  nota        String?    @db.VarChar(255)
  materiales  materiales @relation(fields: [material_id], references: [id], map: "fk_sm_material")
  servicios   servicios  @relation(fields: [servicio_id], references: [id], onDelete: Cascade, map: "fk_sm_servicio")

  @@id([servicio_id, material_id])
  @@index([material_id], map: "idx_sm_material_id")
}

model servicios {
  id                  Int                   @id @default(autoincrement()) @db.UnsignedInt
  nombre              String                @unique(map: "uk_servicios_nombre") @db.VarChar(100)
  descripcion         String?               @db.Text
  margen_porcentaje   Decimal               @default(0.00) @db.Decimal(5, 2)
  activo              Boolean               @default(true)
  creado_en           DateTime              @default(now()) @db.Timestamp(0)
  actualizado_en      DateTime              @default(now()) @db.Timestamp(0)
  servicio_materiales servicio_materiales[]
}

model usuarios_admin {
  id                 Int                  @id @default(autoincrement())
  nombre             String               @db.VarChar(100)
  correo             String               @unique(map: "uk_usuarios_admin_correo") @db.VarChar(150)
  password_hash      String               @db.VarChar(255)
  ultimo_login_en    DateTime?            @db.Timestamp(0)
  activo             Boolean              @default(true)
  creado_en          DateTime             @default(now()) @db.Timestamp(0)
  actualizado_en     DateTime             @default(now()) @db.Timestamp(0)
  blog_publicaciones blog_publicaciones[]
}

model leads {
  id        Int      @id @default(autoincrement())
  nombre    String   @db.VarChar(80)
  telefono  String   @db.VarChar(30)
  mensaje   String   @db.Text
  canal     String   @db.VarChar(30)
  createdAt DateTime @default(now()) @db.Timestamp(0)
  updatedAt DateTime @default(now()) @db.Timestamp(0)

  @@index([canal], map: "idx_leads_canal")
}

enum materiales_tipo {
  FISICO
  TIEMPO
}

enum materiales_unidad {
  UNIDAD
  HORA
  MINUTO
  ML
  G
}

enum blog_publicaciones_estado {
  BORRADOR
  PUBLICADO
  ARCHIVADO
}
